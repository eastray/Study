# Operation System

### index

- 프로세스와 스레드 차이
- 가상 메모리
- 캐시의 지역성


### 프로세스와 스레드 차이

- 프로세스 (Process)

  프로세스는 운영체제로부터 자원을 할당받는 작업의 단위를 말한다. 프로그램이 실행될 때, 운영체제로부터 프로세스를 할당받고 운용되기 위한 요소인 주소 공간, 메모리 등의 자원을 할당 받는다.

- 프로세스 제어 블록 (Process Control Block, PCB)

  특정 프로세스에 대한 중요한 정보를 저장하고 있는 운영체제의 자료구조이다. 운영체제는 프로세스를 관리하기 위해 프로세스의 생성과 동시에 고유의 PCB를 생성한다. 프로세스는 CPU를 할당받아 작업을 처리하다가 프로세스 전환이 발생하면 진행했던 작업을 저장하고 CPU를 반환해야 하는데, 이때 작업의 진행 상황을 모두 PCB에 저장하게 된다. 그리고 다시 CPU를 할당받게 되면 PCB에 저장되어 있던 내용을 불러와 이전에 종료됐던 시점부터 다시 작업을 수행한다.

- 스레드 (Thread)

  프로세스가 할당받은 자원을 이용하는 내부 실행 단위를 의미한다. 스레드는 한 프로세스 내에서 동작하는 여러 실행의 흐름으로, 한 프로세스 내에서 할당받은 주소 공간, 메모리 등의 자원이 공유된다.

멀티 프로세스로 실행되는 작업을 멀티 스레드로 실행할 경우, 프로세스를 생성하는 자원을 할당하는 시스템 콜이 줄어 자원을 효율적으로 관리할 수 있으며, 프로세스 간의 통신보다 스레드 간의 통신 비용이 비교적 적다.

스레드를 활용하면 자원의 효율성이 증가하지만, 스레드의 자원 공유로 인한 동기화 문제가 발생할 수 있다.

- 스택을 스레드마다 독립적으로 할당하는 이유

  스택은 함수 호출 시 전달되는 인자, 되돌아갈 주소 값 및 함수 내에서 선언하는 변수등을 저장하기 위해 사용되는 메모리 공간이며, 스택 메모리 공간이 독립적이라는 것은 독립적인 함수 호출이 가능하다는 것이고 이는 독립적인 실행 흐름이 추가되는 것이다. 따라서 스레드의 정의에 따라 독립적인 실행 흐름을 추가하기 위한 최소 조건으로 독립된 스택을 할당한다.

- PC Resister를 스레드마다 독립적으로 할당하는 이유

  PC 값은 스레드가 명령어를 어디까지 수행하였는지 나타나게 된다. 스레드는 CPU를 할당받고 스케줄러에 의해 다시 선점당한다. 그렇기 때문에 연속적으로 수행되지 못하고 어느 부분까지 수행했는지 기억해야 한다. 따라서 PC 레지스터를 독립적으로 할당한다.


-----

### 가상 메모리

다중 프로그래밍을 실행하기 위해서는 많은 프로세스들을 동시에 메모리에 올려두어야 한다. 가상 메모리는 프로세스 전체가 메모리에 올라오지 않더라도 실행이 가능하도록 하는 기법이다. 프로그램이 물리 메모리보다 커도 된다는 장점이 있다. 가상 메모리는 아래와 같은 요인에 의해 개발되었다.

- 실행되는 코드의 전부를 물리 메모리에 적재해야 하며, 메모리 용량보다 큰 프로그램은 실행 시킬 수 없었다.
- 여러 프로그램을 동시에 메모리에 올리기에는 용량의 한계와 페이지 교체 등의 성능 이슈가 발생했다. 
- 불필요하게 프로그램의 전체가 메모리에 올라와있어야 한다는 단점도 발견되었다. 

가상메모리는 실제의 물리 메모리 개념과 사용자의 논리 메모리 개념을 분리한 것으로 정리할 수 있다.

한 프로세스가 메모리에 저장되는 논리적인 모습을 가상 메모리에 구현한 공간이다. 프로세스가 요구하는 메모리 공간을 중 현재 직접적으로 필요하지 않는 메모리 공간을 가상 메모리에서 제공함으로써 실제 물리 메모리가 아닌 가상 메모리에 적재하여 물리 메모리를 절약할 수 있다.

- 요구 페이징 (Demand Paging)

  프로그램 실행 시작 시에 프로그램 전체를 디스크에서 물리 메모리에 적재하는 대신, 초기에 필요한 것들만 적재하는 전략을 요구 페이징이라 한다. 가상 메모리 시스템에서 많이 사용되며, 가상 메모리는 대개 페이지로 관리된다. 요구 페이징을 사용하는 가상 메모리에서는 실행 과정에서 필요로 할 때까지 페이지가 적재된다. 단 한번도 접근되지 않은 페이지는 물리 메모리에 적재되지 않는다.


-----

### 캐시의 지역성

캐시 메모리는 속도가 빠른 장치와 느린 장치 간의 속도차에 따른 병목 현상을 줄이기 위한 범용 메모리이다. 이러한 역할을 수행하기 위해서는 CPU가 어떤 데이터를 원할 것인가를 어느 정도 예측할 수 있어야 한다. 캐시의 성능은 작은 용량의 캐시 메모리에 CPU가 향후 참조하거나 필요로 할 정보가 얼마만큼 담겨있가에 달려있다.

이때 적중율(Hit Rate)를 극대화하기 위해 데이터 지역성(Locality)의 원리를 사용한다. 지역성의 전제 조건으로 프로그램은 모든 코드나 데이터를 균등하게 접근하지 않는다는 특성을 기본으로 한다. 즉 Locality란 기억 장치 내의 정보를 균일하게 접근하는 것이 아닌 어느 한 순간에 특정 부분을 집중적으로 참조하는 특성이다.

- 시간 지역성

  최근에 참조된 주소의 내용은 곧 다음에 다시 참조되는 특성

- 공간 지역성

  대부분의 실제 프로그램이 참조된 주소와 인접한 주소의 내용이 다시 참조되는 특성



### Todo list

- 멀티스레드
- 스케줄러
- CPU 스케줄러
- 동기, 비동기
- 프로세스 동기화
- 메모리 관리 전략