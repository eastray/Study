# Maven

-----

### Index

- 소프트웨어 빌드
- 빌드 자동화
- Maven
- Ref

-----

## 소프트웨어 빌드

소프트웨어 빌드(Software Build)는 소스 코드 파일을 컴퓨터에서 실행 할 수 있는 독립 소프트웨어 가공물로 변환하는 과정을 말하거나 그에 대한 결과물을 일컫는다.

소프트웨어 빌드에 있어 가장 중요한 단계들 가운데 하나는 소스 코드 파일이 실행 코드로 변환되는 컴파일 과정이다.

-----

## 빌드 자동화

빌드 자동화의 본질적인 목적은 소프트웨어 개발자가 반복해서 하는 코딩을 잘 짜여진 프로세스를 통해 자동으로 실행하여, 믿을 수 있는 결과물도 생상해 낼 수 있는 일련의 작업 방식 및 방법을 말한다.

지속적인 통합(Continuous Integration)과도 같은 의미로, 수없이 반복해서 최종 결과물을 만들어내야 하는 소프트웨어 개발업무에서 빠질 수 없는 개념적 이해가 되었다

-----

## Maven

메이븐은 생성하는 프로젝트의 종류에 따라 기반이 되는 템플릿 프로젝트를 제공한다. 메이븐에서 제공하는 템플릿 프로젝트를 이용하여 메이븐 기반 프로젝트를 생성할 수 있다. 메이븐은 프로젝트의 소스 디렉토리, 테스트 디렉토리, 웹 리소스 디렉토리 등의 기본 설정이 예약되어 있으므로 정해진 규칙에 따라 프로젝트의 뼈대를 만들어야 한다. 메이븐의 템플릿 프로젝트로 프로젝트를 생성하면 프로젝트의 뼈대를 자동으로 생성할 수 있다. 메이븐의 이 같은 기능을 아키타입(Archetype)이라 한다.

메이븐에서 제공하는 아키타입은 메이븐 중앙 저장소에서 관리한다.

메이븐은 설정보다는 관례(Convention over Configuration) 패러다임에 따라 프로젝트의 기본 디렉토리가 이미 정해져 있다. 

-----

## 메이븐 기본 명령어

```mvn [options] [<goal(s)>] [<phase(s)>]```

메이브 명령은 옵션(Options), 골(goals), 페이즈(Phase) 조합으로 실행이 가능하다. 옵션은 메이븐 기본 설정 파일(pom.xml)이 존재하지 않는 곳에서도 실행하는 것이 가능하며, 골과 페이즈는 메이브 기반으로 진행하는 프로젝트의 디렉토리에서 실행할 수 있다.

메이븐 설정 파일에 인자를 전달하는 옵션은 -D 옵션이다. 메이븐 명령을 실행할 때 옵션, 페이즈, 골을 조합해서 사용하는 것이 가능하다.

-----

## 설정 파일

메이븐을 사용하려면 알아야할 설정 파일이 두 가지 있다. 첫째는 메이븐 빌드 툴과 관련한 설정 파일이며, 설정 파일 이름은 settings.xml이다. 둘째는 메이븐 기반 프로젝트에서 사용하는 설정 파일이며, 설정 파일의 이름은 기본으로 pom.xml을 사용한다.

### settings.xml

settings.xml 설정 파일은 메이븐을 설치한 컴퓨터의 모든 사용자에 동일한 설정을 하기 위한 용도로 사용된다.

메이븐은 빌드를 할 때 의존 관계에 있는 라이브러리, 플러그인을 중앙 저장소에서 개발자 PC로 다운로드한다. 이와 같이 다운로드한 라이브러리는 개발자 PC의 특정 디렉토리에 위치하게 되는데 이 디렉토리를 로컬 저장소라 부른다. 로컬 저장소의 기본 설정은 ```USER_HOME/.m2/repository```이다.

### pom.xml

메이븐은 빌드와 관련된 정보를 프로젝트 객체 모델(Project Object Model)이라는 이름으로 정의하고 있다. POM의 이름을 따서 기본 설정 파일은 pom.xml이다. 메이븐은 "mvn" 명령을 실행하면 기본적으로 pom.xmlㅇ 파일을 읽어 빌드를 실행하낟. 만일 다른 설정 파일을 사용하고자 한다면 ``-f`` 또는 ``--file`` 옵션을 사용한다.

![POM](./imege/POM.png)

| Property            | Description                              |
| ------------------- | ---------------------------------------- |
| project             | pom.xml 파일의 최상위 엘리먼트                     |
| modelVersion        | POM의 버전                                  |
| groupId             | 프로젝트를 생성하는 그룹의 고유 아이디                    |
| artifactId          | 프로젝트를 식별하는 유일한 아이디                       |
| packaging           | 프로젝트를 어떤 형태로 패키징할 것인지 설정                 |
| version             | 현재 프로젝트 버전                               |
| name                | 프로젝트 이름                                  |
| url                 | 프로젝트 URL                                 |
| dependencies        | \<dependencies/>와 \<dependency/> 사이에 있는 프로젝트와 의존 관계에 있는 라이브러리 관리 |
| build               | 프로젝트 빌드와 관련된 기본적인 소스 디렉토리 구조, 빌드 산출물 디렉토리 구조, 빌드시 사용할 플러그인 정보 관리 |
| sourceDirectory     | 실제 서비스를 담당하는 자바 소스 코드를 관리하는 디렉토리         |
| testSourceDirectory | 테스트 소스를 관리하기 위한 디렉토리                     |
| outputDirectory     | sourceDirectory의 소스를 컴파일한 결과물이 위치하는 디렉토리 |
| testOutputDirectory | testSourceDirectory의 소스를 컴파일한 결과물이 위치하는 디렉토리 |
| resources           | 서비스에 사용되는 자원을 관리하는 디렉토리                  |
| testResources       | 테스트 시에 필요한 자원을 관리하기 위한 디렉토리              |
| repositories        | 빌드할 때 접근할 저장소의 위치 관리                     |
| pluginManagement    | 빌드 설정 파일에서 관리하는 플러그인 목록                  |

``mvn package`` 명령을 실행하면 컴파일, 테스트를 완료하고 특정 파일로 압축한다.

-----

## 라이플 사이클

메이븐은 라이프 사이클을 가지며, 라이프 사이클의 각 단계를 페이즈(Phase)라고 부른다. 라이프 사이클은 순서가 정해져 있으며, 순차저긍로 페이즈를 실행한다.

프로젝트를 빌드할 때의 과정은 빌드 결과물 삭제, 컴파일을 하기 위해 필요한 자원 복사, 소스 코드 컴파일, 테스트, 압축(패키지), 배포의 과정을 거치며, 메이븐은 빌드 단계를 미리 정의한다. 

메이븐은 빌드 순서를 라이프 사이클이라 하며, 라이프 사이클의빌드 단계를 페이즈라 부른다. 메이븐에는 모두 세 개의 라이프 사이클이 있다. 

- 기본 라이프 사이클: 소스 코드를 컴파일, 테스트, 압축, 배포 담당
- clean 라이프 사이클: 빌드한 켤과물 제거 담당
- site 라이프 사이클: 프로젝트 문서 사이트 생성 담당

![라이프사이클종류](./imege/라이프사이클종류.png)

### 기본 라이프 사이클

메이븐은 기본 라이프 사이클을 활용해 소스 코드 컴파일, 테스트, 압축, 배포와 같은 일련의 작업이 모두 실행된다.

- compile: 소스 코드 컴파일
- test: Unit, TestNG와 같은 단위 테스트 프레임워크로 단위 테스트 실행
- package: 단위 테스트 성공시, pom.xml의 <packaging /> 엘리언트 값(jar, war, ear 등)에 따라 압축
- install: 로컬 저장소에 압축한 파일을 배포. 로컬 저장소는 개발자 PC의 저장소를 의미.
- deploy: 원격 저장소에 압축한 파일 배포. 원격 저장소는 외부에 위치한 메이븐 저장소를 의미.

### clean 라이프 사이클

clean 라이프 사이클은 clean 페이즈를 이용하여 실행항 수 있다. clean 페이즈를 실행하면 메이븐 빌드를 통해 생성된 모든 산출물을 삭제한다. 메이븐의 기본으로 모든 산출물을 target 디렉토리에 생성하는데 clean 페이즈를 실행하면 target 디렉토리를 삭제한다.

### site 라이프 사이클

site 라이프 사이클은 site와 site-deploy 페이즈를 이용하여 실행할 수 있다. site 라이프 사이클은 메이븐 설정 파일의 정보를 활용하여 프로젝트에 대한 문서 사이트를 생성할 수 있도록 지원한다.

-----

## 페이즈와 플러그인의 관계

메이븐 플러그인은 하나의 플러그인에서 여러 작업을 수행할 수 있도록 지원한다. 메이븐은 플러그인에서 실행할 수 있는 각각의 작업을 골(Goal)이라 정의한다.

메이븐에서 페이즈는 빌드 라이프 사이클에서 빌드 단계와 각 단계의 순서만을 정의하고 있는 개념이다. 빌드 과정에서 페이즈가 실질적인 빌드 작업을 하지 않으며, 실질적인 빌드 작업은 각 페이즈에 연결되어 있는 플러그인의 골이 한다. 예를 들어 ``mvn complie``과 같이 complie 페이즈를 실행한 것이다.![페이즈와골](./imege/페이즈와골.png)

![메이븐의페이즈와골](./imege/메이븐의페이즈와골.png)



-----

### Ref

- [자바 세상의 빌드를 이끄는 메이븐](https://www.slipp.net/wiki/pages/viewpage.action?pageId=10420233)